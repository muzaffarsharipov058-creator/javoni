<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MUZAFFARcall - Private Meet</title>
    <script src='https://meet.jit.si/external_api.js'></script>
    <style>
        :root { --primary: #0066ff; --bg: #121212; --card: #1e1e1e; --text: #fff; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; height: 100vh; overflow: hidden; }
        
        .screen { display: none; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        .card { width: 90%; max-width: 400px; background: var(--card); padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        input { width: 100%; background: #2c2c2c; border: 1px solid #333; padding: 15px; border-radius: 10px; color: white; font-size: 16px; margin-bottom: 15px; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--primary); }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 10px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: #333; color: white; }
        .btn:hover { opacity: 0.9; }

        #video-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: black; }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–≤–µ—Ä—Ö –≤–∏–¥–µ–æ */
        .controls { position: absolute; top: 20px; left: 20px; z-index: 20; display: flex; gap: 10px; }
        .ctrl-btn { background: rgba(0,0,0,0.6); color: white; border: 1px solid #555; padding: 8px 15px; border-radius: 20px; cursor: pointer; backdrop-filter: blur(5px); }
        .ctrl-btn.red { color: #ff4444; border-color: #ff4444; }
    </style>
</head>
<body>

    <div id="login-screen" class="screen active">
        <div class="card">
            <h2>–í—Ö–æ–¥</h2>
            <p style="color:#888; font-size: 14px;">–ö–∞–∫ –≤–∞—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å?</p>
            <input type="text" id="username" placeholder="–í–∞—à–µ –∏–º—è">
            <button class="btn btn-primary" onclick="login()">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <div id="dashboard-screen" class="screen">
        <div class="card">
            <h2 id="greet">–ü—Ä–∏–≤–µn –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MUZAFFARcall!</h2>
            <p style="color:#888; font-size: 14px;">–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–ª—É—á–∞–π–Ω—É—é</p>
            
            <input type="text" id="room-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: proekt-1)">
            <button class="btn btn-primary" onclick="createNamedRoom()">üìπ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
            <button class="btn btn-secondary" onclick="createRandomRoom()">üé≤ –°–ª—É—á–∞–π–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞</button>
            
            <p style="font-size: 12px; color: #555; margin-top: 20px;">
                –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É, –∏ –æ–Ω —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–µ—Ç –∫ –≤–∞–º.
            </p>
        </div>
    </div>

    <div id="video-screen" style="display: none;">
        <div class="controls">
            <button class="ctrl-btn red" onclick="leaveRoom()">–í—ã–π—Ç–∏</button>
            <button class="ctrl-btn" onclick="copyLink()">üîó –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
        </div>
        <div id="video-container"></div>
    </div>

    <script>
        // === –í–ê–ñ–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –°–ï–†–í–ï–† ===
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º meet.guifi.net –≤–º–µ—Å—Ç–æ meet.jit.si, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ª–æ–≥–∏–Ω–∞
        // –ï—Å–ª–∏ –æ–Ω –±—É–¥–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å, –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å: 'meet.golem.de' –∏–ª–∏ 'framatalk.org'
        const DOMAIN = 'meet.guifi.net'; 
        
        const PREFIX = "MY_PRIV_V1_"; 
        
        let api = null;
        let user = localStorage.getItem('user_name');

        window.onload = () => {
            const hash = window.location.hash.replace('#', '');
            if(user) {
                if(hash) startMeeting(hash);
                else showDashboard();
            }
        };

        function login() {
            const val = document.getElementById('username').value;
            if(!val) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è");
            user = val;
            localStorage.setItem('user_name', user);
            
            const hash = window.location.hash.replace('#', '');
            if(hash) startMeeting(hash);
            else showDashboard();
        }

        function showDashboard() {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('video-screen').style.display = 'none';
            document.getElementById('dashboard-screen').classList.add('active');
            document.getElementById('greet').innerText = `–ü—Ä–∏–≤–µ—Ç, ${user}!`;
            history.pushState("", document.title, window.location.pathname);
        }

        function createNamedRoom() {
            let name = document.getElementById('room-name').value;
            name = name.replace(/[^a-zA-Z0-9-_]/g, ''); // –¢–æ–ª—å–∫–æ –∞–Ω–≥–ª –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã
            
            if(!name) return alert("–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è!");
            startMeeting(name);
        }

        function createRandomRoom() {
            const id = Math.random().toString(36).substring(2, 10);
            startMeeting(id);
        }

        function startMeeting(roomID) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('video-screen').style.display = 'block';
            
            window.location.hash = roomID;

            const options = {
                roomName: PREFIX + roomID, 
                width: '100%',
                height: '100%',
                parentNode: document.querySelector('#video-container'),
                userInfo: { displayName: user },
                // –û—Ç–∫–ª—é—á–∞–µ–º –ª–∏—à–Ω–∏–µ —ç–∫—Ä–∞–Ω—ã
                configOverwrite: { 
                    prejoinPageEnabled: false,
                    startWithAudioMuted: false, 
                    startWithVideoMuted: false 
                },
                interfaceConfigOverwrite: { 
                    MOBILE_APP_PROMO: false,
                    SHOW_JITSI_WATERMARK: false
                }
            };

            if(api) api.dispose();
            // –í–ê–ñ–ù–û: –¢—É—Ç –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é DOMAIN, –∫–æ—Ç–æ—Ä—É—é –∑–∞–¥–∞–ª–∏ –≤—ã—à–µ
            api = new JitsiMeetExternalAPI(DOMAIN, options);
            
            api.addEventListeners({
                readyToClose: () => leaveRoom(),
                videoConferenceLeft: () => leaveRoom()
            });
        }

        function leaveRoom() {
            if(api) api.dispose();
            showDashboard();
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href)
                .then(() => alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!"))
                .catch(() => alert("–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏."));
        }
    </script>
</body>
</html>